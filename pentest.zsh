function ntlm_hash {
    printf '%s' "$1" | iconv -t utf16le | openssl md4 | cut -d ' ' -f 2
}

function nmap_web_fast {
    sudo nmap -oA $(date +%Y-%m-%d_%H:%M:%S) -vvv --reason -n -Pn -sSV --top-ports 1000 --version-intensity=3 --script http-headers,http-title,http-methods,http-favicon --script-args="http.useragent=Nmap/1.0"  "$@"
}

function nmap_web_full {
    sudo nmap -oA $(date +%Y-%m-%d_%H:%M:%S) -vvv --reason -Pn -sSV -p- --script http-headers,http-title,http-methods,http-enum,http-cookie-flags,http-cors,http-cross-domain-policy,http-backup-finder,http-devframework,http-errors,http-favicon,http-git,http-internal-ip-disclosure,http-robots.txt,http-security-headers,http-server-header,http-svn-info,http-svn-enum,http-traceroute,http-useragent-tester,http-vhosts,http-waf-detect,http-waf-fingerprint,http-webdav-scan,ssl-cert,ssl-cert-intaddr,ssl-dh-params,ssl-enum-ciphers,ssl-heartbleed,sslv2,tls-alpn,tls-nextprotoneg,db2-das-info,mongodb-info,mongodb-databases,ms-sql-info,mysql-info,oracle-tns-version --script-args="http.useragent=Nmap/1.0"  "$@"
}

function nmap_lan_custom {
    sudo nmap -oA $(date +%Y-%m-%d_%H:%M:%S) -vvv --reason -n -sSUV -T4 -pT:7,21,22,23,25,43,53,66,79,80,81,82,88,110,111,135,137-139,389,443,445,457,512,513,514,541,554,631,636,873,1080,1090,1098,1099,1100,1128,1241,1311,1352,1389,1433-1435,1521-1530,1583,1636,1944,2000,2049,2100,2301,2375,2376,2381,3000,3050,3128,3200,3201,3203,3204,3205,3299,3306,3307,3351,3389,3632,4000,4001,4002,4100,4443,4444,4445,4786,4848,4949,5000,5050,5060,55432,5433,5555,5556,5601,5666,5800,5801,5802,5900,5984,5985,5986,6000-6009,6060,6061,6112,6129,6346,6347,6379,7000-7004,7070,7071,7443,7444,8000-8003,8006,8009,8080-8090,8443,8471,8500,8686,8834,8880,8888,8889,9000-9003,9012,9060,9080,9081,9090,9091,9200,9300,9443,9471,9503,10000,10250,10255,10999,11099,11111,11211,12174,19200,27017-27019,27080,28017,30821,38292,45000,45001,47001,47002,50000,50013,50100,50500,51443,U:53,67,68,69,137,161,162,137-139,500,554,1194,1434,1604,2049,3478,3479,4500,5004,5060 --script "(default or discovery) and safe and not broadcast" "$@"
}

function nmap_lan_custom_noscript {
    sudo nmap -oA $(date +%Y-%m-%d_%H:%M:%S) -vvv --reason -n -sSUV -T4 -pT:7,21,22,23,25,43,53,66,79,80,81,82,88,110,111,135,137-139,389,443,445,457,512,513,514,541,554,631,636,873,1080,1090,1098,1099,1100,1128,1241,1311,1352,1389,1433-1435,1521-1530,1583,1636,1944,2000,2049,2100,2301,2375,2376,2381,3000,3050,3128,3200,3201,3203,3204,3205,3299,3306,3307,3351,3389,3632,4000,4001,4002,4100,4443,4444,4445,4786,4848,4949,5000,5050,5060,55432,5433,5555,5556,5601,5666,5800,5801,5802,5900,5984,5985,5986,6000-6009,6060,6061,6112,6129,6346,6347,6379,7000-7004,7070,7071,7443,7444,8000-8003,8006,8009,8080-8090,8443,8471,8500,8686,8834,8880,8888,8889,9000-9003,9012,9060,9080,9081,9090,9091,9200,9300,9443,9471,9503,10000,10250,10255,10999,11099,11111,11211,12174,19200,27017-27019,27080,28017,30821,38292,45000,45001,47001,47002,50000,50013,50100,50500,51443,U:53,67,68,69,137,161,162,137-139,500,554,1194,1434,1604,2049,3478,3479,4500,5004,5060 "$@"
}

function nmap_lan_custom_noping {
    sudo nmap -oA $(date +%Y-%m-%d_%H:%M:%S) -vvv --reason -n -Pn -sSUV -T4 -pT:7,21,22,23,25,43,53,66,79,80,81,82,88,110,111,135,137-139,389,443,445,457,512,513,514,541,554,631,636,873,1080,1090,1098,1099,1100,1128,1241,1311,1352,1389,1433-1435,1521-1530,1583,1636,1944,2000,2049,2100,2301,2375,2376,2381,3000,3050,3128,3200,3201,3203,3204,3205,3299,3306,3307,3351,3389,3632,4000,4001,4002,4100,4443,4444,4445,4786,4848,4949,5000,5050,5060,55432,5433,5555,5556,5601,5666,5800,5801,5802,5900,5984,5985,5986,6000-6009,6060,6061,6112,6129,6346,6347,6379,7000-7004,7070,7071,7443,7444,8000-8003,8006,8009,8080-8090,8443,8471,8500,8686,8834,8880,8888,8889,9000-9003,9012,9060,9080,9081,9090,9091,9200,9300,9443,9471,9503,10000,10250,10255,10999,11099,11111,11211,12174,19200,27017-27019,27080,28017,30821,38292,45000,45001,47001,47002,50000,50013,50100,50500,51443,U:53,67,68,69,137,161,162,137-139,500,554,1194,1434,1604,2049,3478,3479,4500,5004,5060 --script "(default or discovery) and safe and not broadcast" "$@"
}

function nmap_lan_custom_noping_noscript_fast {
    sudo nmap -oA $(date +%Y-%m-%d_%H:%M:%S) -vvv --reason -n -Pn -sSUV -T5 -pT:7,21,22,23,25,43,53,66,79,80,81,82,88,110,111,135,137-139,389,443,445,457,512,513,514,541,554,631,636,873,1080,1090,1098,1099,1100,1128,1241,1311,1352,1389,1433-1435,1521-1530,1583,1636,1944,2000,2049,2100,2301,2375,2376,2381,3000,3050,3128,3200,3201,3203,3204,3205,3299,3306,3307,3351,3389,3632,4000,4001,4002,4100,4443,4444,4445,4786,4848,4949,5000,5050,5060,55432,5433,5555,5556,5601,5666,5800,5801,5802,5900,5984,5985,5986,6000-6009,6060,6061,6112,6129,6346,6347,6379,7000-7004,7070,7071,7443,7444,8000-8003,8006,8009,8080-8090,8443,8471,8500,8686,8834,8880,8888,8889,9000-9003,9012,9060,9080,9081,9090,9091,9200,9300,9443,9471,9503,10000,10250,10255,10999,11099,11111,11211,12174,19200,27017-27019,27080,28017,30821,38292,45000,45001,47001,47002,50000,50013,50100,50500,51443,U:53,67,68,69,137,161,162,137-139,500,554,1194,1434,1604,2049,3478,3479,4500,5004,5060 "$@"
}

function nmap_lan_full {
    sudo nmap -oA $(date +%Y-%m-%d_%H:%M:%S) -vvv --reason -sSUV -T4 -pT:-,U:53,67,68,69,137,161,162,137-139,500,554,1194,1434,1604,2049,3478,3479,4500,5004,5060 --script "(default or discovery) and safe and not broadcast" "$@"
}

function nmap_lan_full_noping {
    sudo nmap -oA $(date +%Y-%m-%d_%H:%M:%S) -vvv --reason -Pn -sSUV -T4 -pT:-,U:53,67,68,69,137,161,162,137-139,500,554,1194,1434,1604,2049,3478,3479,4500,5004,5060 --script "(default or discovery) and safe and not broadcast" "$@"
}

function nmap_lan_discovery {
    sudo nmap -oA $(date +%Y-%m-%d_%H:%M:%S) -vvv --reason -sV -sn --script "(broadcast or discovery or default) and safe and not intrusive" --script-args=newtargets
}

function new_pentest {
    date_stamp=$(date +%Y-%m)
    echo -n "Project name? "
    read proj_name
    proj_id="${date_stamp}_${proj_name}"

    if read -q  "confirm?New project id is : $proj_id. Is this OK? (y/Y)"; then
        echo "\n"
        echo -n "Creating project sheet..."
        cp "$HOME/org-work/templates/projet.org" "$HOME/org-work/missions/$proj_id.org"
        sed -i "s/FIXME_projectxxx/$proj_id/" "$HOME/org-work/missions/$proj_id.org"
        echo "done"
        echo -n "Creating project folders..."
        mkdir -p "$HOME/missions/$proj_id/"{scans,docs,screenshots,fuzz}
        echo "done"
    else
        echo "\nAborting."
    fi
}
